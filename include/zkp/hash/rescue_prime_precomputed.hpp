/*
 * Copyright (C) 2023-2025 Ligero, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#pragma once

#include <zkp/finite_ring.hpp>

namespace ligero::vm::zkp {

template <size_t m, size_t capacity, size_t security, uint64_t... primes>
struct rescue_prime_params;

static constexpr uint64_t p0 = 255086697644033ULL;
static constexpr uint64_t p1 = 96757023244289ULL;

template <>
struct rescue_prime_params<12, 4, 128, p0, p1> {
    static constexpr size_t state_width = 12;
    static constexpr size_t capacity = 4;
    static constexpr size_t rate = state_width - capacity;
    static constexpr size_t num_rounds = 7;
    static constexpr uint64_t p[2] = { p0, p1 };
    static constexpr uint64_t alpha[2] = { 3, 3 };
    static constexpr uint64_t alpha_inv[2] = { 170057798429355ULL, 64504682162859ULL };

    static constexpr const char* seed_string[2] = {
        "Rescue-XLIX(255086697644033,12,4,128)",
        "Rescue-XLIX(96757023244289,12,4,128)"
    };

    using rr = finite_crt_ring<p[0], p[1]>;

    static constexpr rr MDS[state_width * state_width] = {
        rr{  179449900233275ULL,  42775735010472ULL },
        rr{  242227347447033ULL,   3595437510152ULL },
        rr{  124799245709791ULL,  65222661039121ULL },
        rr{   34862322557709ULL,   2033710086004ULL },
        rr{  244305528012015ULL,  93449629963275ULL },
        rr{  241208378347209ULL,  94490857786079ULL },
        rr{  222863411553290ULL,  11781810742214ULL },
        rr{  243407007426812ULL,  76281206247403ULL },
        rr{  146792505414141ULL,  23647203118603ULL },
        rr{  105708888254407ULL,  70524516165573ULL },
        rr{  255069045930863ULL,  96739371531119ULL },
        rr{           265720ULL,          265720ULL },
        rr{   71099386744310ULL,  30515406258143ULL },
        rr{   79230495215310ULL,  43583418490326ULL },
        rr{  116930233533487ULL,  44597282185170ULL },
        rr{   12637639442843ULL,  74691894667936ULL },
        rr{  141168942869372ULL,   5533206922911ULL },
        rr{   30603118079783ULL,  46919723612522ULL },
        rr{  109721465728927ULL,  86997186675275ULL },
        rr{   80342428894648ULL,  18620471053342ULL },
        rr{  130835508599236ULL,  16490350820325ULL },
        rr{  240868393748386ULL,  91334811771221ULL },
        rr{    6856222314601ULL,  24448408359045ULL },
        rr{      52955405230ULL,     52955405230ULL },
        rr{  241308435946943ULL,  74706342641850ULL },
        rr{  162842312151811ULL,  38649860357015ULL },
        rr{  150450109366970ULL,  35710648923817ULL },
        rr{  139518043223554ULL,  45742376332140ULL },
        rr{  233848450378288ULL,  89857107049153ULL },
        rr{   99333198332648ULL,  72647030750107ULL },
        rr{  134561222261407ULL,  75984409306376ULL },
        rr{   78436400620521ULL,  45890837397323ULL },
        rr{   43082603980998ULL,  56642763878736ULL },
        rr{  112265496820405ULL,  68166519051620ULL },
        rr{   86475783172268ULL,   7310951369147ULL },
        rr{   48398129608386ULL,  65990315652740ULL },
        rr{   84387065947178ULL,  58439675569661ULL },
        rr{  212761360422783ULL,  84478023624137ULL },
        rr{  237097683777778ULL,  57876174952620ULL },
        rr{   68188221748897ULL,  25214115542865ULL },
        rr{  108621279009701ULL,  55069889562812ULL },
        rr{  161567072986030ULL,  39401531126727ULL },
        rr{  120112380734755ULL,  95051404412116ULL },
        rr{  111941736026981ULL,  50503524239481ULL },
        rr{   66500794875818ULL,  51039290423346ULL },
        rr{   77922930336849ULL,  80131440677811ULL },
        rr{   39806060420936ULL,  14402364654815ULL },
        rr{  241613599576493ULL,  65691727923633ULL },
        rr{   91967425588221ULL,  88192955820568ULL },
        rr{  198377986214475ULL,  17409502775528ULL },
        rr{  250850347751624ULL,  60957192188473ULL },
        rr{  188519110357615ULL,  45196538749785ULL },
        rr{   97486757020681ULL,  33360016200042ULL },
        rr{   11022755199053ULL,  62097717894911ULL },
        rr{   26875682526473ULL,  70168953042276ULL },
        rr{  123736238996234ULL,  18884926252370ULL },
        rr{   32578819533408ULL,   8221947097846ULL },
        rr{   17075036182154ULL,  77399505970163ULL },
        rr{  126954341154937ULL,  25842060259532ULL },
        rr{  109988987695291ULL,  72810823214241ULL },
        rr{   90476268317580ULL,  59516267542810ULL },
        rr{  124712708131153ULL,  86400787584410ULL },
        rr{   27622469935789ULL,  18485474181056ULL },
        rr{   25077023673214ULL,   6064981591238ULL },
        rr{  178274545324114ULL,  25533965285565ULL },
        rr{  166847381817838ULL,  42150825211674ULL },
        rr{  150626382646535ULL,  64293050308745ULL },
        rr{   83808242069547ULL,   7571637732810ULL },
        rr{   63201149043558ULL,  92422988541286ULL },
        rr{  220737496828205ULL,  40697365642250ULL },
        rr{   46580953990118ULL,  63715105761412ULL },
        rr{   97468866442515ULL,  73689690082479ULL },
        rr{    5997928586302ULL,  43915747648991ULL },
        rr{   53666335612275ULL,  91370383964038ULL },
        rr{  194829695060482ULL,  55972280994291ULL },
        rr{  166065052528341ULL,  70015489748319ULL },
        rr{  105559985195247ULL,  74007983653511ULL },
        rr{   42277969217202ULL,  55602649502625ULL },
        rr{  150119533520662ULL,  51928891851858ULL },
        rr{  146070983902982ULL,  28259016281574ULL },
        rr{  179246038901703ULL,   8586283618198ULL },
        rr{  168379191482706ULL,  94927454814432ULL },
        rr{   52033909094902ULL,  30100128560114ULL },
        rr{   11186865117362ULL,  72612852072073ULL },
        rr{   12128979040582ULL,  53801082386527ULL },
        rr{  162703478130922ULL,  90613999964634ULL },
        rr{  119199018491881ULL,  30545413850057ULL },
        rr{  171323883440708ULL,  70162908730615ULL },
        rr{   66989892033878ULL,  71118843610377ULL },
        rr{  180048059153567ULL,  38928401608263ULL },
        rr{  177668247841372ULL,  20688600874682ULL },
        rr{  250128880632650ULL,  47636137668841ULL },
        rr{   35990974012146ULL,  28365492828274ULL },
        rr{  107547407701504ULL,  85685418117146ULL },
        rr{  146246116775996ULL,  30876356675291ULL },
        rr{  100545248608993ULL,  12119483151028ULL },
        rr{  227715309917684ULL,  42441424192644ULL },
        rr{  203644324620115ULL,  54930501071788ULL },
        rr{   78168877338468ULL,  26456334514644ULL },
        rr{   99836282103616ULL,  90222730390710ULL },
        rr{   77587974197687ULL,  66891706138669ULL },
        rr{  208359911450026ULL,  33571695352510ULL },
        rr{  238578010540779ULL,  40393177296631ULL },
        rr{   48238613915780ULL,   1519086093569ULL },
        rr{    7137289234366ULL,  87961387049679ULL },
        rr{  137450886332700ULL,  24277308322244ULL },
        rr{  189547350901343ULL,  55942180877983ULL },
        rr{   14255355311635ULL,  55934608164664ULL },
        rr{  195968585540446ULL,  96604764906721ULL },
        rr{  155753368812781ULL,  34239818682566ULL },
        rr{   72859021781628ULL,  83473850408532ULL },
        rr{  213444935406033ULL,  71573012870373ULL },
        rr{  228007705130172ULL,  72810689749756ULL },
        rr{   44811737142881ULL,  34289911431444ULL },
        rr{   26849609115350ULL,  13878442170597ULL },
        rr{   90141204783544ULL,  49478421319114ULL },
        rr{  174817428913381ULL,  11139300406841ULL },
        rr{  229093495945369ULL,  10917231422076ULL },
        rr{   13672348629121ULL,  45210579179231ULL },
        rr{   85100744663493ULL,  56926116918484ULL },
        rr{  160168115824297ULL,  28688197240008ULL },
        rr{  121345308824384ULL,  94452060526069ULL },
        rr{   97828937568304ULL,  58539524241174ULL },
        rr{  199939542141757ULL,  60261715733823ULL },
        rr{   69640689716542ULL,  44032385104429ULL },
        rr{  116024010281253ULL,  71501937480225ULL },
        rr{  195025257938171ULL,  43348725237663ULL },
        rr{  157418426680298ULL,  15916292910221ULL },
        rr{   82742523875247ULL,  51712140510199ULL },
        rr{  150292655695228ULL,   6433790781174ULL },
        rr{  122123133567021ULL,  65129083629565ULL },
        rr{   57971583751697ULL,  40526286071185ULL },
        rr{  168003096774366ULL,  87632813146037ULL },
        rr{  153876425595280ULL,    841179242461ULL },
        rr{   41698641084246ULL,  18728218398443ULL },
        rr{  246609212500080ULL,  55280004685164ULL },
        rr{   53571059189667ULL,  72517281070358ULL },
        rr{  219454672215907ULL,  31013035543285ULL },
        rr{    6681024079679ULL,  10262551786283ULL },
        rr{  213610380654200ULL,  44077823707756ULL },
        rr{  131345378724896ULL,  75335509338080ULL },
        rr{  204850747677659ULL,  41848222402218ULL },
        rr{  190045938383195ULL,   6043554382140ULL },
        rr{  155860306629057ULL,  40204922519221ULL },
    };

    static constexpr rr C[2 * state_width * num_rounds] = {
        rr{   50606503446025ULL,  20570155835560ULL },
        rr{   52986979389721ULL,  52716454516965ULL },
        rr{  114013866053148ULL,  41805790550077ULL },
        rr{  207121609313332ULL,   5585435736995ULL },
        rr{  134809833149758ULL,  18309419110624ULL },
        rr{  125035906256983ULL,  12324017847896ULL },
        rr{  173525717915852ULL,  58444348180778ULL },
        rr{  103148240377379ULL,  81839526329362ULL },
        rr{   43459418584653ULL,  63330821869437ULL },
        rr{   75962092124196ULL,  92491002921267ULL },
        rr{  140385352689433ULL,  90907715419982ULL },
        rr{  135826068810022ULL,  53526607563602ULL },
        rr{   56885795558408ULL,   2624736402863ULL },
        rr{   21348302117631ULL,  84897898913224ULL },
        rr{   93064191794038ULL,  26548973894721ULL },
        rr{  128037613331359ULL,  72509173321839ULL },
        rr{  175878492440913ULL,  66657565072927ULL },
        rr{   14675551455761ULL,  90332562218898ULL },
        rr{   14655507762535ULL,  25863491889224ULL },
        rr{   47009702151825ULL,  69614800217284ULL },
        rr{   50275848032587ULL,  30061106911117ULL },
        rr{    8575004972201ULL,  20040676377477ULL },
        rr{    1565814356846ULL,  44810130592272ULL },
        rr{  176549584369483ULL,  82452525770500ULL },
        rr{  251795099560629ULL,   1855690831864ULL },
        rr{   79992157220855ULL,  16648894298712ULL },
        rr{  114749107212846ULL,  26517787312255ULL },
        rr{   26345130136977ULL,  70417079037630ULL },
        rr{  130900318566174ULL,  42238247766797ULL },
        rr{   14351501653435ULL,  43531185979566ULL },
        rr{   77232510242567ULL,  32818766448594ULL },
        rr{   87920188296017ULL,  25241794449598ULL },
        rr{   67941358453492ULL,  23509370131622ULL },
        rr{   24292028857106ULL,  94447266101446ULL },
        rr{  126400001587424ULL,  58277874864697ULL },
        rr{  168324813413067ULL,  14294193711256ULL },
        rr{  172130299713572ULL,  27775950803824ULL },
        rr{   98719295893496ULL,  83263774508412ULL },
        rr{   45161911402464ULL,  40653509253513ULL },
        rr{   88335187899732ULL,  66428490868931ULL },
        rr{  154482596319821ULL,  87347375228942ULL },
        rr{  137578379719368ULL,  13486968988163ULL },
        rr{  219294613181134ULL,  52209001847132ULL },
        rr{   64270203043938ULL,  89303674916189ULL },
        rr{  152702928125288ULL,   6739696315960ULL },
        rr{   39111690077066ULL,  14483444226246ULL },
        rr{   35141384239630ULL,  16565931522373ULL },
        rr{   13207514820520ULL,  92402068615990ULL },
        rr{  215721929642238ULL,  94475091051250ULL },
        rr{  123097564461845ULL,  91182776063599ULL },
        rr{  145395301495673ULL,  84461328669171ULL },
        rr{  170844366994180ULL,  51675695786478ULL },
        rr{  167863532833669ULL,  72193473916003ULL },
        rr{  183210771122773ULL,  21255812564556ULL },
        rr{  217617343216925ULL,  42673682717852ULL },
        rr{     620474348476ULL,  85057217136601ULL },
        rr{  243113556596711ULL,  45352402020601ULL },
        rr{  237899897616100ULL,  37157265261062ULL },
        rr{  203900510022497ULL,  91048265534704ULL },
        rr{  175263718562196ULL,  87280085368831ULL },
        rr{  252468293580562ULL,   4583167381951ULL },
        rr{  107682300089932ULL,  17047810141300ULL },
        rr{    8272092279252ULL,  10283922629849ULL },
        rr{  203993458904089ULL,  66084907027511ULL },
        rr{  236776788263752ULL,   7544471746700ULL },
        rr{  250636118254254ULL,  70885712804477ULL },
        rr{  209612297749710ULL,  68062239392971ULL },
        rr{  253130935626032ULL,  37592700463409ULL },
        rr{  110679960404050ULL,  49843501488574ULL },
        rr{   90193499649667ULL,  93958256861116ULL },
        rr{  240693390116356ULL,  39957479424150ULL },
        rr{  232416360430351ULL,  81727044942828ULL },
        rr{  164885793670628ULL,  58478143786506ULL },
        rr{   17329552449647ULL,  81590107229451ULL },
        rr{  162048552838698ULL,  72657683512974ULL },
        rr{   72302489128232ULL,  91831774491856ULL },
        rr{  104469750050358ULL,  56674966158816ULL },
        rr{   70188077646360ULL,  16627763030551ULL },
        rr{   20363326943318ULL,  70348333674920ULL },
        rr{  167646934354747ULL,  81237467198562ULL },
        rr{    4703803099345ULL,  20933717874515ULL },
        rr{  143933044832488ULL,  28632261351111ULL },
        rr{    5217004982605ULL,  27967900057041ULL },
        rr{  237716594671716ULL,  67387206157579ULL },
        rr{  204343791638194ULL,  63385859034012ULL },
        rr{   74337052741237ULL,  59006739711109ULL },
        rr{  127017437063690ULL,  95110947002664ULL },
        rr{   70025046525169ULL,  73957241329020ULL },
        rr{   82839489908614ULL,  80304526060337ULL },
        rr{  116581860345600ULL,  45148672694413ULL },
        rr{  187878318785234ULL,  51577029885735ULL },
        rr{  214343902685010ULL,  31243254044506ULL },
        rr{  117744306874808ULL,  41890503053648ULL },
        rr{   83700417653485ULL,  79731502783650ULL },
        rr{   99739542723748ULL,  55510219887163ULL },
        rr{  203555463135194ULL,  13829807018516ULL },
        rr{  115285914607395ULL,   6881187286334ULL },
        rr{  247666073511432ULL,  66441935996316ULL },
        rr{  243021902460952ULL,  51659598625302ULL },
        rr{  143186617337217ULL,  47933396949142ULL },
        rr{   69717578510709ULL,  34836738720220ULL },
        rr{   98192057166076ULL,  90542364308337ULL },
        rr{  230773283581604ULL,  23542529528527ULL },
        rr{  196475540080397ULL,   9073962345578ULL },
        rr{   72594205822591ULL,   7941692457554ULL },
        rr{  224370743458793ULL,  37279840398869ULL },
        rr{   13852211153581ULL,  67096026080847ULL },
        rr{  105687659604105ULL,  91324980633474ULL },
        rr{  129843521993770ULL,  29436821637096ULL },
        rr{  185167737443392ULL,  73660018338307ULL },
        rr{  235252261326648ULL,  24272797676813ULL },
        rr{  149197719548587ULL,  51245529901660ULL },
        rr{   43716654891288ULL,    713987005978ULL },
        rr{   59704224007322ULL,  96430441132903ULL },
        rr{   97920211830546ULL,  46854397951259ULL },
        rr{  176634548419546ULL,  90201831342040ULL },
        rr{  204853399563240ULL,  61788698765644ULL },
        rr{   42222213839771ULL,  63886127625565ULL },
        rr{  175115330414955ULL,  96392556055640ULL },
        rr{   49510889519801ULL,  90773065151303ULL },
        rr{    4053610438400ULL,  88310014122076ULL },
        rr{  194763277318969ULL,  86482824108905ULL },
        rr{  227569303901127ULL,   5419751923833ULL },
        rr{   71698192826291ULL,  18714237828275ULL },
        rr{   98687531430208ULL,  94545733430051ULL },
        rr{  187423625147362ULL,  25855954237622ULL },
        rr{  210894238318665ULL,  83634051045553ULL },
        rr{  248226911122492ULL,  87161042727974ULL },
        rr{   44462890287999ULL,   4172501597294ULL },
        rr{   83373669478560ULL,  17981439714801ULL },
        rr{  207837641101893ULL,  75678083039510ULL },
        rr{  202354178642503ULL,  49728285831277ULL },
        rr{   12331500176067ULL,  61588740626697ULL },
        rr{  208134446574598ULL,   2361720350423ULL },
        rr{   82067303981792ULL,  20310647891563ULL },
        rr{  173861915485766ULL,  11175975944082ULL },
        rr{  140514803567052ULL,  71075409742089ULL },
        rr{   47196351838700ULL,  13178787268477ULL },
        rr{  193316441814454ULL,  46045677524746ULL },
        rr{  103146404643382ULL,  17769660375596ULL },
        rr{   76058675107737ULL,  44319683006141ULL },
        rr{  160700420238743ULL,  84574142647060ULL },
        rr{   50154899021774ULL,  15515597461653ULL },
        rr{  241325012489863ULL,  42762801416693ULL },
        rr{  220791454545906ULL,  87818949732541ULL },
        rr{  177850673038636ULL,  51274130471832ULL },
        rr{   44758594051784ULL,  84554371099440ULL },
        rr{  247728574848900ULL,  94208486215189ULL },
        rr{  140372772209349ULL,  34419675237881ULL },
        rr{   63630623928571ULL,  50709432295098ULL },
        rr{  215424339623358ULL,  31142489256336ULL },
        rr{  128161024669939ULL,  85791193103176ULL },
        rr{  191477196013879ULL,  44535060312941ULL },
        rr{    6170400869471ULL,  29923015902947ULL },
        rr{   85042350671726ULL,  68114921239645ULL },
        rr{  252747829395871ULL,  76421260328172ULL },
        rr{  203231945658848ULL,  90398038817134ULL },
        rr{   40167030571697ULL,   2870374497641ULL },
        rr{  199304263147470ULL,  61114359660694ULL },
        rr{  181936464927617ULL,  73050585451553ULL },
        rr{   65054562210432ULL,   4044904851457ULL },
        rr{   65106234356310ULL,  15196171831475ULL },
        rr{   34099070321347ULL,  67754720605715ULL },
        rr{  250593992062674ULL,  51641205850132ULL },
        rr{  249155152050104ULL,  10042846066897ULL },
        rr{  201068426323986ULL,  74675688374165ULL },
        rr{  216072708348836ULL,  61684774035858ULL },
        rr{  152429067997901ULL,  76089227362222ULL },
    };
};

}  // namespace ligero::vm::zkp
